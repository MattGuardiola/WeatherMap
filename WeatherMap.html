<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/WeatherMap.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="js/mapbox-geocoder-utilities.js"></script>
    <script src="js/keys.js"></script>
    <meta charset="UTF-8">
    <title>First Mapbox Map</title>
    <!-- Mapbox CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet'/>
    <!-- Custom CSS -->
    <style>
        #map {
            /* the width and height may be set to any size */
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>

<h1>My First Mapbox Map!</h1>

<!-- The HTML element that serves as the Mapbox container -->
<div id='map'></div>
<button type="button" class="btn btn-primary m-2" onclick="setZoom(5)">5x</button>
<button type="button" class="btn btn-primary m-2" onclick="setZoom(10)">10x</button>
<button type="button" class="btn btn-primary m-2" onclick="setZoom(15)">15x</button>
<br>
<div id="weather-form">
<input class="ms-4 mb-4" type="text" id="search-box" placeholder="Enter location">
<button type="button" class="btn btn-primary ms-2" onclick="addToArray()">add pin</button>
</div>
<div id="weather-info"></div>
<!--<main class="container-fluid">-->
<!--    <h2>Weather</h2>-->
<!--    &lt;!&ndash; results for weather data &ndash;&gt;-->
<!--    <div class="row gx-2">-->
<!--        <div class="col">-->
<!--            <div class="card" style="width: 30vw">-->
<!--                <h5 class="card-title p-2">Date</h5>-->
<!--                <img-->
<!--                        src="http://openweathermap.org/img/wn/10d@4x.png"-->
<!--                        class="card-img-top"-->
<!--                        alt="Weather description"-->
<!--                />-->
<!--                <div class="card-body">-->
<!--                    <h3 class="card-title">Weather Label</h3>-->
<!--                    <p class="card-text">High Temp Low Temp</p>-->
<!--                    <p class="card-text">HighFeels like</p>-->
<!--                    <p class="card-text">Humidty</p>-->
<!--                    <p class="card-text">Precipitation</p>-->
<!--                    <p class="card-text">Wind speed and direction</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</main>-->

<!-- Mapbox JS -->
<script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>

<!-- Custom JS -->


<script
        src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous">

</script>
<script>
    mapboxgl.accessToken = MAPBOX_API_KEY;
    let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        zoom: 10,
        center: [-98.4916, 29.4252]
    });


    function addToArray() {
        let newLocation = document.getElementById("search-box").value
        pinThatAdress(newLocation)
    }


    function setZoom(zoom) {
        map.setZoom(zoom);
    }


    function pinThatAdress(adress) {

        geocode(adress, MAPBOX_API_KEY).then(function (result) {
            map.setCenter(result)
            map.setZoom(12);
            marker = new mapboxgl.Marker();
            marker.setLngLat(result);
            marker.addTo(map);
            let popup = new mapboxgl.Popup();
            popup.setHTML(`<h3>` + adress + `</h3>`);
            marker.setPopup(popup);
            getWeatherData(result);

        });
    }


function getWeatherData(result) {

    $.get("http://api.openweathermap.org/data/2.5/weather", {
        APPID: OPENWEATHER_API_KEY,
        lat: result[1],
        lon: result[0],
        units: "imperial"
    }).done(function (data) {
        console.log('The entire response:', data);
        console.log('Diving in - here is current information: ', data.current);
        console.log('A step further - information for tomorrow: ', data.daily[1]);
    });
}















    // function setWeather() {
    //     $.ajax("data/inventory.json")
    //         .done(function (data) {
    //             console.log(data)
    //             let html = ''
    //             data.forEach(function (equipment) {
    //                 html += `
    //                     <tr>
    //                         <td>${equipment.title}</td>
    //                         <td>${equipment.quantity}</td>
    //                         <td>${equipment.price}</td>
    //                         <td>${equipment.categories.join(" / ")}</td>
    //                     </tr>`
    //             })
    //             $('#insertProducts').html(html)
    //             console.log(data)
    //         })
    // }
    //
    //
    //
    //
    //
    // // Get the form element
    // const weatherForm = $('#weather-form');
    //
    // // Bind a submit event listener to the form
    // weatherForm.on('button', function (e) {
    //     e.preventDefault();
    //
    //     // Get the value of the city name or ZIP code input field
    //     const cityName = $('#search-box').val();
    //
    //     // Make a GET request to the OpenWeatherMap API
    //     $.get(`https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${OPENWEATHER_API_KEY}`, function (data) {
    //
    //         // Extract the relevant information from the API response
    //         const temperature = data.main.temp;
    //         const humidity = data.main.humidity;
    //         const weather = data.weather[0].main;
    //
    //         // Update the weather info div with the extracted information
    //         $('#weather-info').html(`Temperature: ${temperature} &#8451; <br> Humidity: ${humidity}% <br> Weather: ${weather}`);
    //     }).fail(function (error) {
    //         console.log(error);
    //         $('#weather-info').html(`Sorry, there was an error with your request. Please try again later.`);
    //     });
    // });


</script>
</body>
</html>