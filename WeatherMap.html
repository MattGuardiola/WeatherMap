<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://kit.fontawesome.com/66bf6e2046.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/WeatherMap.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="js/mapbox-geocoder-utilities.js"></script>
    <script src="js/keys.js"></script>
    <meta charset="UTF-8">
    <title>First Mapbox Map</title>
    <!-- Mapbox CSS -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet'/>
</head>
<body>

<nav class= 'navbar navbar-dark mb-5'>
    <div class="container-fluid">
        <a class="navbar-brand"><i class="fa-solid fa-sun-cloud"></i>Codeup Clouds (and other weather conditions)</a>
        <form class="d-flex">
            <input  class="search-box form-control me-2" id="search-box" type="search" placeholder="Enter Location" aria-label="Search">
            <button class="search-button btn btn-outline-light" type="button" onclick="addToArray()">Search</button>
        </form>
    </div>
</nav>

<!-- The HTML element that serves as the Mapbox container -->
<div id='map'></div>
<div class="zoom-buttons"></div>
<button type="button" class="zoom" onclick="setZoom(5)">5x</button>
<button type="button" class="zoom" onclick="setZoom(10)">10x</button>
<button type="button" class="zoom" onclick="setZoom(15)">15x</button>
</div>
<br>
<div id="weather-info"></div>

<!-- Mapbox JS -->
<script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>

<!-- Custom JS -->


<script
        src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous">

</script>
<script>
    mapboxgl.accessToken = MAPBOX_API_KEY;
    let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        zoom: 10,
        center: [-98.4916, 29.4252]
    });


    function addToArray() {
        let newLocation = document.getElementById("search-box").value
        pinThatAdress(newLocation)
    }


    function setZoom(zoom) {
        map.setZoom(zoom);
    }


    function pinThatAdress(adress) {

        geocode(adress, MAPBOX_API_KEY).then(function (result) {
            map.setCenter(result)
            map.setZoom(12);
            marker = new mapboxgl.Marker();
            marker.setLngLat(result);
            marker.addTo(map);
            let popup = new mapboxgl.Popup();
            popup.setHTML(`<h3>` + adress + `</h3>`);
            marker.setPopup(popup);
            getWeatherData(result);

        });
    }


function getWeatherData(result) {

    $.get(`https://api.openweathermap.org/data/2.5/forecast`, {
        APPID: OPENWEATHER_API_KEY,
        lat: result[1],
        lon: result[0],
        units: "imperial"
    }).done(function (data) {
        console.log('The entire response:', data);
        console.log('Diving in - here is current information: ', data.current);
        console.log('A step further - information for tomorrow: ', data.list[1]);
    });
}



























    // function setWeather() {
    //     $.ajax("data/inventory.json")
    //         .done(function (data) {
    //             console.log(data)
    //             let html = ''
    //             data.forEach(function (equipment) {
    //                 html += `
    //                     <tr>
    //                         <td>${equipment.title}</td>
    //                         <td>${equipment.quantity}</td>
    //                         <td>${equipment.price}</td>
    //                         <td>${equipment.categories.join(" / ")}</td>
    //                     </tr>`
    //             })
    //             $('#insertProducts').html(html)
    //             console.log(data)
    //         })
    // }
    //
    //
    //
    //
    //
    // // Get the form element
    // const weatherForm = $('#weather-form');
    //
    // // Bind a submit event listener to the form
    // weatherForm.on('button', function (e) {
    //     e.preventDefault();
    //
    //     // Get the value of the city name or ZIP code input field
    //     const cityName = $('#search-box').val();
    //
    //     // Make a GET request to the OpenWeatherMap API
    //     $.get(`https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${OPENWEATHER_API_KEY}`, function (data) {
    //
    //         // Extract the relevant information from the API response
    //         const temperature = data.main.temp;
    //         const humidity = data.main.humidity;
    //         const weather = data.weather[0].main;
    //
    //         // Update the weather info div with the extracted information
    //         $('#weather-info').html(`Temperature: ${temperature} &#8451; <br> Humidity: ${humidity}% <br> Weather: ${weather}`);
    //     }).fail(function (error) {
    //         console.log(error);
    //         $('#weather-info').html(`Sorry, there was an error with your request. Please try again later.`);
    //     });
    // });


</script>
</body>
</html>